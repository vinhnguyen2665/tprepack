<script language="javascript" type="text/javascript">


var language_t = new Array(
	["pon_title_", 		"Pon Parameter", 		"PON认证设置", 			innerHTML_t, noSubIndex],
	["pon_info_", 		"Pon Authentication", 	"设置PON的认证信息", 	innerHTML_t, noSubIndex],
	["onu_loid_",		"ID:",					"认证ID:", 				innerHTML_t, noSubIndex],
	["onu_password_", 	"Password:", 			"密码:", 				innerHTML_t, noSubIndex],
	["save", 			"Save", 				"保存", 				innerHTML_t, noSubIndex]
	);


var timeId = 0;
	
var connectType_route = "IP_Routed";
var connectType_bridge = "IP_Bridged";
var addressType_dhcp = "DHCP";
var addressType_auto = "AutoIp";
var addressType_static = "Static";
var connectState_connecting = "Connecting";
var connectState_connected = "Connected";
var connectState_pending = "PendingDisconnect";
var connectState_disconnecting = "Disconneting";
var connectState_disconnected = "Disconnected";

var dhcp_ip_value = 2;
var static_ip_value = 1;

var enable_type = 0;

var loidfocused = 0;
var pwdfocused = 0;
var pon = "";

var static_stk = " ";
var dhcp_stk = " ";
var dny_connected = 0;
var dny_connecting = 1;
var dnyAction = dny_connecting;
var wanIpList;

var DEFAULT_PON_INDEX = 0;
/* add by yuan */
var gponPassword;
var gponSNumber;

function checkPwd(type,pwd)
{
	var flag = true;
	var regExp = /^([a-f]|[A-F]|[0-9]){1,20}$/;
	if (type == 0) //ASCII
	{
		if ((pwd.length > 10) || $.asc(pwd, true))
		{
			alert("Please input 1-10 ASCII characters");
			flag = false;
		}
	}
	else if (type == 1) //HEX
	{
		if(!regExp.test(pwd))
		{
			alert("Please input 1-20 Hexadecimal Numbers");
			flag = false;
		}
	}
	return flag;
	
}	

function checkSn(sn)
{
	var flag = true;
	var regExp = /^([a-f]|[A-F]|[0-9]){1,16}$/;

	if(!regExp.test(sn))
	{
		alert("Please input 16 Hexadecimal Numbers ");
		flag = false;
	}
	if(sn.length != 16)
	{
		alert("Input length is less than 16");
		flag = false;
	}
	return flag;
	
}	
/* end add*/
function loidfocus(obj)
{
	if (!loidfocused)
	{
		obj.value = "";
		loidfocused = 1;
	}
}
	
function pwdfocus(obj)
{
	if (!pwdfocused) 
	{
		obj.value = "";
		pwdfocused = 1;
	}
}

function save_event()
{
	var arg = {};
	var val;
	
	var onuLoid = "";
	var onuPassword="";
	
	if (loidfocused)
	{
		val = $.id("onu_loid").value;
		
		if ($.asc(val, true))
			return $.alert(91201);
			
		onuLoid = encodeURIComponent(val);
	}

	if (pwdfocused)
	{
		val = $.id("onu_password").value;
		
		if ($.asc(val, true))
			return $.alert(91202);
	
		onuPassword = encodeURIComponent(val);
	}
		
	if (loidfocused && pwdfocused)
	{
		$.act(ACT_SET, PON, pon[DEFAULT_PON_INDEX].__stack, null, ["loid=" + onuLoid, "passwd="+onuPassword]);
	}
	else if (loidfocused) /* yuan 14July12 */
	{
		$.act(ACT_SET, PON, pon[DEFAULT_PON_INDEX].__stack, null, ["loid=" + onuLoid]);
	}
	else if (pwdfocused)
	{
		$.act(ACT_SET, PON, pon[DEFAULT_PON_INDEX].__stack, null, ["passwd=" + onuPassword]);
	}
	
	$.exe();
	
}
	
function release_time_fun()
{

	wanIp = $.act(ACT_GET, WAN_IP_CONN, dhcp_stk, null, ["enable","connectionStatus","addressingType", "connectionType", "externalIPAddress","defaultGateway", "DNSServers", "subnetMask"]);
	
	if (!$.exe())
	{
		if (wanIp.connectionStatus != connectState_connected)
		{
			if (timeId != 0)
			{
				window.clearTimeout(timeId);
			}
			
			$.reload();
		}
		
		else if (wanIp.connectionStatus == connectState_connected)
		{
		
			if (timeId != 0)
			{
				window.clearTimeout(timeId);
			}
			
			timeId = window.setTimeout("release_time_fun()",3000);
		}
	}
	
}


function renew_time_fun()
{
	wanIp = $.act(ACT_GET, WAN_IP_CONN, dhcp_stk, null, ["enable","connectionStatus","addressingType", "connectionType", "externalIPAddress","defaultGateway", "DNSServers", "subnetMask"]);
	
	if (!$.exe())
	{
		if (wanIp.connectionStatus == connectState_connected)
		{
			if (timeId != 0)
			{
				window.clearTimeout(timeId);
			}
			$.reload();
		}
		
		
		else
		{
		
			if (timeId != 0)
			{
				window.clearTimeout(timeId);
			}
			
			timeId = window.setTimeout("renew_time_fun()",5000);
		}
	}
}
	
	
	
function showDnyIp()
{
	$.removeClass($.id("dhcp_ip_div"), "nd");
	hidenStaticIp();
	
}

function hidenDnyIp()
{
	$.addClass($.id("dhcp_ip_div"), "nd");
}

function showStaticIp()
{
	$.removeClass($.id("static_ip_div"), "nd");
	hidenDnyIp();
} 
function hidenStaticIp()
{
	$.addClass($.id("static_ip_div"), "nd");
}

function showIpType()
{
	if ($.id("static_ip").selected == true)
	{
		showStaticIp();
	}
	else
	{
		showDnyIp();
	}
	
	return;
}
	
function disableDhcpIp()
{
	var arg = {};
	arg.enable = 0;
	$.act(ACT_SET, WAN_IP_CONN,dhcp_stk, null, arg);
	if (!$.exe())
	{
		return 1;
	}
	
	return 0;
	
}

function disableStaticIp()
{
	var arg = {};
	arg.enable = 0;
	$.act(ACT_SET, WAN_IP_CONN,static_stk, null, arg);
	if(!$.exe())
	{
		return 1;
	}
	return 0;
}
	
function doStaticIPClick()
{
	var arg = {};
	if ($.id("dyn_ip").checked == true)
	{
		return;
	}
	
	
	if (static_stk == " ")
	{
		alert("stack error.");
		return;
	}
	
	if (!disableDhcpIp())
	{
		alert("error.");
		return;
	}

	arg.externalIPAddress = $.id("ip_address").value;
	arg.defaultGateway = $.id("ip_gateway").value;
	arg.enable = 1;
	arg.subnetMask = $.id("netmask").value;
	var dns = $.id("dns_address").value;
	dns += ",";
	dns += $.id("second_dns").value;
	arg.DNSServers = dns;
	$.act(ACT_SET, WAN_IP_CONN,static_stk, null, arg);
	
	if (!$.exe())
	{
		$.reload();
	}
		
}



function doDnyIpClick()
{
	if ($.id("dyn_ip").checked == false)
	{
		return;
	}
	
	if (dhcp_stk == " ")
	{
		alert("stack error.");
		return;
	}
	
	
	
	if (dnyAction == dny_connected)
	{
	
		if (!disableStaticIp())
	{
			alert("error.");
			return;
	}
	
		$.act(ACT_OP, ACT_OP_DHCP_RELEASE, dhcp_stk);
	if (!$.exe())
	{
			release_time_fun();
		}
	
	}
	else if (dnyAction == dny_connecting)
	{
		
		var arg = {};
		arg.enable = 0;
		var argdhcp = {};
		argdhcp.enable = 1;
		$.act(ACT_SET, WAN_IP_CONN,static_stk, null, arg);
		$.act(ACT_SET, WAN_IP_CONN,dhcp_stk, null, argdhcp);
		$.act(ACT_OP, ACT_OP_DHCP_RENEW, dhcp_stk);
		
		if (!$.exe())
		{
			renew_time_fun();
		}
	}
	
	
}

function fillStaticIpMsg(wanIp)
{
	$.id("ip_address").value = wanIp.externalIPAddress;
	$.id("ip_gateway").value = wanIp.defaultGateway;
	$.id("netmask").value = wanIp.subnetMask;
	var dns = wanIp.DNSServers.split(",");
	if (dns.length && dns.length == 2)
	{
		$.id("dns_address").value = dns[0];
		$.id("second_dns").value = dns[1];
		
	}
	else 
	{
		$.id("dns_address").value = dns;
	}
	
}

function fillDynIpMsg(wanIp)
{
	$.id("dyn_ip_addr").innerHTML = wanIp.externalIPAddress;
	$.id("dyn_mask").innerHTML = wanIp.subnetMask;
	$.id("dyn_gw").innerHTML = wanIp.defaultGateway;
	var dns = wanIp.DNSServers.split(",");
	if (dns.length && dns.length == 2)
	{
		$.id("dyn_dns1").innerHTML = dns[0];
		$.id("dyn_dns2").innerHTML = dns[1];
		
	}
	else 
	{
		$.id("dyn_dns1").innerHTML = dns;
	}

	if (dnyAction == dny_connected)
	{
		$.id("dny_ip_but").value = "Release";
	}
	else
	{
		$.id("dny_ip_but").value = "Save";
	}
}


function showLinkType()
{
	showIpType();
}
	
function doSave1()
{
	//var type = $.id("pwd_type").value;
	var newPwd = $.id("newpwd").value;

	if (newPwd.length == 0)
	{
                if(confirm("Entered password is blank, which means to remove the password. Are you sure to modify?"))
		{
			;
		}
		else
		{
			return;
		}
	}
	if (checkPwd(0,newPwd) == false)
	{
		return;
	}
	newPwd = newPwd;
	$.act(ACT_SET, GPON_AUTH_PWD, gponPassword._stack,null, ["GponPwd=" + newPwd,"PwdType=0"]);
	if (! $.exe())
	{
		$.act(ACT_OP, ACT_OP_OMCI_RESTART);
		$.exe();
		$.reload();
	}
}
/* add by yuan 2012-07-24*/
function doSave2()
{
	var newSn = $.id("newsn").value;
	if (newSn.length == 0)
		{
			alert("Please input SN");
			return;
		}
	if (checkSn(newSn) == false)
	{
		return;
	}
	
	$.act(ACT_SET, GPON_AUTH_SN, gponSNumber._stack,null, ["GponSn=" + newSn]);
	
	if (! $.exe())
	{
		$.act(ACT_OP, ACT_OP_OMCI_RESTART);
		$.exe();
		$.reload();
	}
}
function init()
{
	gponPassword= $.act(ACT_GET, GPON_AUTH_PWD, null, null,["gponPwd","pwdType"]);
	gponSNumber= $.act(ACT_GET, GPON_AUTH_SN, null, null,["gponSn"]);

	if (!$.exe())
	{
		/* add by yuan */
		$.id("cur_pwd").value = gponPassword.gponPwd;
		$.h($.id("cur_pwd_len"), gponPassword.gponPwd.length);
		
		$.id("cur_sn").value = gponSNumber.gponSn;				
	}
}

</script>
<p class="et"><b>PON Certification</b></p>
<div class="con1 M">
<p class="ct" id="gpon_title_"><b>GPON Password</b></p>
<p class="bl"></p>
<p class="st T"><b id="pon_info_">GPON Password</b></p>
<div class="con2">
<!--十六进制数最多输入20个字符-->
<p id="gpon_info_">GPON Password(Notice: Maximum 10 ASCII characters)</p>
<p class="L1"><b class="item M" id="cur_pwd_">Old Password:</b><input  class="text" size="16" maxlength="10" id="cur_pwd" disabled/> (<span id="cur_pwd_len"></span>)characters</p>

<p class="L1"><b class="item M" id="new_pwd_">New Password:</b><input  class="text" size="16" maxlength="10" id="newpwd" /></p>
<p class="br" />
<p class="center">
<input type="button" class="button L" value="Save" id="save" onclick="doSave1();" /></p>
</div>
</div>

<p class="bl"></p>
<!--add by yuan 2012-07-24 -->
<div class="con1 M">
<p class="ct" id="gpon_sn_title_"><b>GPON SN</b></p>
<p class="st T"><b id="pon_info_">GPON SN</b></p>
<div class="con2">
<p id="gpon_sn_info_">GPON SN(Notice: Must be 16 Hexadecimal Numbers )</p>
<p class="L1"><b class="item M" id="cur_sn_">Old SN:</b><input  class="text" size="16" maxlength="16" id="cur_sn" disabled /></p>
<p class="L1"><b class="item M" id="new_sn_">New SN:</b><input  class="text" size="16" maxlength="16" id="newsn" /></p>
<p class="br" />
<p class="center">
<input type="button" class="button L" value="Save" id="save" onclick="doSave2();" /></p>

<p class="bl"></p>
</div>
</div>

<script language="javascript" type="text/javascript">
init();
</script>
	
	
	