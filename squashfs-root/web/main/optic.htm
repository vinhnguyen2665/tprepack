<script language="javascript" type="text/javascript">
var language_t = new Array(
	["optic_info_",		"Optical Info",		"光链路信息", 	innerHTML_t, 	noSubIndex],
	["onu_temp_", 		"Temperature:",		"温度:",		innerHTML_t, 	noSubIndex],
	["onu_vol_", 		"Voltage:",			"电压:",		innerHTML_t, 	noSubIndex],
	["onu_cur_",		"Current:",			"偏置电流:",	innerHTML_t, 	noSubIndex],
	["tx_power_",		"Tx Power:",		"发送功率:",	innerHTML_t, 	noSubIndex],
	["rx_power_",		"Rx Power:",		"接收功率:",	innerHTML_t, 	noSubIndex],
	["refresh",			"Refresh",			"刷新",			value_t, 		noSubIndex]
	);
	
var DEFAULT_PON_INDEX = 0;
/*
function init()
{
	$.auto(function(){$.reload(); return false;}, 10000);
	
	var ponList = $.act(ACT_GL, PON, null, null, ["ponType"]);
	
	if (!$.exe())
	{
	
	
		var opticInfo = $.act(ACT_GET, OPTICAL, ponList[DEFAULT_PON_INDEX].__stack, null, ["temperature","voltage", "txPower", "rxPower", "current"]);
	
		if (!$.exe())
		{
	
			$.h($.id("temperature"), opticInfo.temperature ? opticInfo.temperature : "N/A");
			$.h($.id("voltage"), opticInfo.voltage ? opticInfo.voltage : "N/A");
			$.h($.id("current"), opticInfo.current ? opticInfo.current : "N/A");

			//$.h($.id("tx_power"), opticInfo.txPower ? opticInfo.txPower : "N/A");
			if (!opticInfo.txPower)
				$.h($.id("tx_power"),"N/A");
			else if (opticInfo.txPower == -999)
				$.h($.id("tx_power"), "-");
			else
				$.h($.id("tx_power"), opticInfo.txPower);

			//$.h($.id("rx_power"), opticInfo.rxPower ? opticInfo.rxPower  : "N/A");
			if (!opticInfo.rxPower)
				$.h($.id("rx_power"),"N/A");
			else if (opticInfo.rxPower == -999)
				$.h($.id("rx_power"), "-");
			else
				$.h($.id("rx_power"), opticInfo.rxPower);
		}
	}
} 
*/
function init()
{
	$.auto(function(){$.reload(); return false;}, 100000);
	
	var ponList = $.act(ACT_GL, PON, null, null, ["ponType"]);
	if (!$.exe())
	{
		var opticInfo = $.act(ACT_GET, OPTICAL, ponList[DEFAULT_PON_INDEX].__stack, null, ["temperature","voltage", "txPower", "rxPower", "bias"]);
		if (!$.exe())
		{

			//OMCI规定的最小单位
			var temperatureCalibration 	= 256;	//获取到的温度，	最小单位为1/256摄氏度.	除以256，变成摄氏度
			var vottageCalibration 		= 20;	//获取到的电压，	最小单位20mV.			乘以20，变成mV
			var biasCurrentCalibration 	= 500;	//获取到的偏置电流，最小单位2uA.			除以500变成mA
			var TXPowerCalibration 		= 500;	//获取到的功率，	最小单位0.002dBuw.		除以500,变成dBuw,再减30变成dBm
			var RXPowerCalibration 		= 500;
			
			//Tx光功率小于-6dBm，认为没有发光。
			var TXPowerIgnore = -6.0;
			//Rx光功率小于-33dBm，认为没有发光。
			var RXPowerIgnore = -33.0;
			
			//下面3个参数是带符号数
			var temperature = parseInt(opticInfo.temperature);
			var txPower 	= parseInt(opticInfo.txPower);
			var rxPower 	= parseInt(opticInfo.rxPower);
			
			//正负数的判断和转换
			if (32767 < temperature)
			{
				temperature = (temperature - 1) ^ 0xffff ;
				temperature *= -1;
			}
			
			if (32767 < txPower)
			{
				txPower = (txPower - 1) ^ 0xffff;
				txPower *= -1;
			}

			if (32767 < rxPower)
			{
				rxPower = (rxPower - 1) ^ 0xffff;
				rxPower *= -1;
			}
			
			//将单位转换为摄氏度,mV,mA,dBm
			var tempTemperature = (temperature * 1.0 ) / temperatureCalibration;
			$.h($.id("temperature"), tempTemperature.toFixed(2));

			var tempVottage 	= opticInfo.voltage  * vottageCalibration;
			$.h($.id("voltage"), tempVottage);

			var tempBiasCurrent = (opticInfo.bias * 1.0) / biasCurrentCalibration;
			$.h($.id("current"), tempBiasCurrent.toFixed(2));

			var tempTXPower 	= (txPower * 1.0) / TXPowerCalibration - 30.0;
			var tempRXPower 	= (rxPower * 1.0) / RXPowerCalibration - 30.0;

			if (TXPowerIgnore >= tempTXPower)
			{
				 $.h($.id("tx_power"), "--");
			}
			else
			{
				$.h($.id("tx_power"), tempTXPower.toFixed(2));
			}
			
			if (RXPowerIgnore >= tempRXPower)
			{
				 $.h($.id("rx_power"), "--");
			}
			else
			{
				$.h($.id("rx_power"), tempRXPower.toFixed(2));
			}


			
		}
	}
}
</script>
<p class="et"><b>Optical Status</b></p>
<div class="con1 M">
<p class="ct" id="optic_info_"><b>Optical Status</b></p>
<p class="bl"></p>
<div class="con2">
<p class="br"></p>
<p class="L2"><b class="item M" id="onu_temp_">Temperature:</b><span id="temperature">- </span>&nbsp;<sup>o</sup>C</p>
<p class="L2"><b class="item M" id="onu_vol_">Voltage:</b><span id="voltage">-</span> mV</p>
<p class="L2"><b class="item M" id="onu_cur_">Bias Current:</b><span id="current">-</span> mA</p>
<p class="L2"><b class="item M" id="tx_power_">TX Power:</b><span id="tx_power">-</span> dBm</p>
<p class="L2"><b class="item M" id="rx_power_">RX Power:</b><span id="rx_power">-</span> dBm</p>
</div>
<p class="bl"></p>
<p class="center">
<input type="button" class="button L" value="Refresh" id="refresh" onclick="$.reload()"/></p>
</div>
<script language="javascript" type="text/javascript">
init();
</script>
	
	
	
